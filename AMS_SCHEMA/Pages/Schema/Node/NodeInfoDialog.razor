@using AMS_SCHEMA.Pages.Schema.Index
@using AMS_SCHEMA.Pages.Schema.Label
@using AMS_SCHEMA.Pages.Schema.Constraint
@using AMS_SCHEMA.Pages.Schema.Department
@using AMS_SCHEMA.Pages.Schema.Label.CodeGen
@using AMS_SCHEMA.Pages.Schema.Label.Module
@using AMS_SCHEMA.Pages.Schema.Label.Property
@using AMS_SCHEMA.Pages.Schema.Query
@using AMS_SCHEMA.Pages.Schema.Relation
@using AMS_SCHEMA.Pages.Schema.Required
@using Olive

<MudDialog Class="Xmud-ex-dialog-initial">
    <DialogContent>
        <MudGrid>
            <MudItem sm="3" md="3">
                <MudButton Variant="Variant.Text" Color="Color.Success" StartIcon="@Icons.TwoTone.Edit" OnClick="EditNodeClick">
                    Edit Node Name
                </MudButton>
                
                <MudTreeView Items="RootLabels" Style="max-height: 680px;overflow-y: scroll;"
                             Hover="true"
                             @bind-SelectedValue="SelectedTreeNodeLabel">
                    <ItemTemplate>
                        <MudTreeViewItem Value="@context" Items="@context.Items" @bind-Expanded="@context.IsExpanded">
                            <Content>
                                <MudTreeViewItemToggleButton @bind-Expanded="@context.IsExpanded"
                                                             Visible="@(context.Label.ChildLabels is {Count: >0})" />
                                <LabelIconComponent Label="@context.Label"></LabelIconComponent>
                                <MudText>@context.Label.Name</MudText>
                                <MudSpacer />
                                <MudIconButton Icon="@Icons.TwoTone.Add" Color="Color.Info" OnClick="()=>AddNewSubLabelClick(context)"></MudIconButton>
                            </Content>
                        </MudTreeViewItem>
                    </ItemTemplate>
                </MudTreeView>

            </MudItem>
            <MudItem sm="9" md="9">
                <MudStack Row="true" Spacing="2">
                    <LabelListComponent @ref="_labelList" Label="SelectedLabel"></LabelListComponent>
                    
                    <MudSpacer />
                    <MudButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Info" StartIcon="@Icons.TwoTone.Info" OnClick="ClassConfigurationClick">
                        Class Configuration
                        
                    </MudButton>

                </MudStack>

                @if (!SelectedLabel.Description.IsEmpty())
                {
                    <MudPaper Class="ma-2 pa-3" Elevation="2">
                        <MudText Typo="Typo.h6" Color="Color.Info">
                            @SelectedLabel.Description
                        </MudText>
                    </MudPaper>
                }

                <MudTabs Class="height:100%" @ref="_tabs">
                    <MudContainer Style="min-height: 400px; max-height: 600px; overflow-y: scroll;">
                        <MudTabPanel Text="Node, Labels and PropertiesDict" Icon="@Icons.Filled.Workspaces">
                            <PropertyListComponent Label="SelectedLabel"></PropertyListComponent>
                        </MudTabPanel>

                        <MudTabPanel Text="Code Gen" Icon="@Icons.Filled.GeneratingTokens" BadgeColor="Color.Primary">
                            <CodGenCongListComponent Label="SelectedLabel"></CodGenCongListComponent>
                        </MudTabPanel>

                        <MudTabPanel Text="Module Setting" Icon="@Icons.Filled.ViewModule" BadgeColor="Color.Warning">
                            <ModuleSettingPanel Label="SelectedLabel"></ModuleSettingPanel>
                        </MudTabPanel>

                        <MudTabPanel Text="Relation" Icon="@Icons.Filled.CompareArrows" BadgeColor="Color.Secondary">
                            <RelationListComponent Label="SelectedLabel"></RelationListComponent>
                        </MudTabPanel>

                        <MudTabPanel Text="Required" Icon="@Icons.Filled.RequestQuote" BadgeColor="Color.Secondary">
                            <RequiredLabelListComponent Label="SelectedLabel"></RequiredLabelListComponent>
                        </MudTabPanel>

                        <MudTabPanel Text="Queries" Icon="@Icons.Filled.QueryBuilder" BadgeColor="Color.Secondary">
                            <LabelQueryListComponent Label="SelectedLabel"></LabelQueryListComponent>
                        </MudTabPanel>

                        <MudTabPanel Text="Constraints" Icon="@Icons.Filled.BackHand" BadgeColor="Color.Info">
                            <ConstraintListComponent Label="SelectedLabel"></ConstraintListComponent>
                        </MudTabPanel>

                        <MudTabPanel Text="Indices" Icon="@Icons.Filled.Bolt" BadgeColor="Color.Warning">
                            <IndexListComponent Label="SelectedLabel"></IndexListComponent>
                        </MudTabPanel>

                        <MudTabPanel Text="Department" Icon="@Icons.Filled.SettingsInputComponent">
                            <DepartmentListComponent Label="SelectedLabel"></DepartmentListComponent>
                        </MudTabPanel>
                    </MudContainer>

                </MudTabs>
            </MudItem>
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Filled" Color="Color.Info" StartIcon="@Icons.TwoTone.Save" OnClick="SaveAndCloseClick">
            Save and Close
        </MudButton>
    </DialogActions>
</MudDialog>
